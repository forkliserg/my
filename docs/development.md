# Разработка и вклад

## Структура исходного кода

### source/
- `main.py` - основной исполняемый файл (содержит только main функцию, которая вызывает другие функции)
- `config/` - настройки проекта и константы:
  - `settings.py` - общие настройки проекта
  - `URLS.txt` - список URL для основных конфигов
  - `URLS_base64.txt` - список URL для base64-кодированных подписок
  - `URLS_yaml.txt` - список URL для YAML-конфигов
  - `whitelist-all.txt` - список доменов для фильтрации SNI обхода
  - `cidrwhitelist.txt` - список CIDR для фильтрации IP-адресов обхода
- `fetchers/` - модули загрузки конфигов:
  - `fetcher.py` - базовый модуль загрузки конфигов
  - `daily_repo_fetcher.py` - модуль загрузки конфигов из ежедневно обновляемого репозитория
  - `yaml_converter.py` - модуль конвертации YAML-конфигов в формат VPN URL
- `processors/config_processor.py` - основной модуль обработки и фильтрации конфигов (содержит всю логику обработки)
- `utils/` - вспомогательные модули:
  - `logger.py` - логирование
  - `file_utils.py` - файловые операции, включая фильтрацию insecure конфигов
  - `github_handler.py` - работа с GitHub API

## Новые функции и улучшения

- Модуль `main.py` теперь содержит только main функцию, которая вызывает другие функции из других модулей
- Весь основной код обработки перемещен в `processors/config_processor.py`
- Добавлена функция `is_valid_vpn_config_url()` в модули `utils/file_utils.py` для проверки, является ли строка действительной VPN конфигурацией по формату протокол://
- Все функции обработки конфигов теперь используют валидацию, чтобы избежать включения неподходящих строк (например, текстовых комментариев) в итоговые файлы
- Улучшена логика обработки bypass конфигов: configs из EXTRA_URLS_FOR_BYPASS теперь правильно обрабатываются отдельно от основных configs и добавляются к bypass файлам без SNI/CIDR фильтрации
- Добавлена функция `apply_sni_cidr_filter()` в `utils/file_utils.py` для унифицированной фильтрации по SNI и CIDR
- Улучшена архитектура: чистое разделение ответственности между модулями
- Добавлена поддержка ежедневно обновляемого репозитория VPN-конфигов: автоматический поиск конфигов по дате с учетом часовых поясов и поддержка base64-декодирования

## Запуск локально

```bash
git clone https://github.com/whoahaow/rjsxrd
cd rjsxrd/source
pip install -r requirements.txt
export MY_TOKEN=<GITHUB_TOKEN>  # токен с правом repo
python main.py  # конфиги появятся в ../githubmirror
```

Для локального тестирования без загрузки в GitHub используйте флаг `--dry-run`:
```bash
python main.py --dry-run
```

## Внесение изменений

1. Форкните репозиторий
2. Создайте новую ветку: `git checkout -b feature/новая-функция`
3. Внесите изменения
4. Сделайте коммит: `git commit -m 'Добавил новую функцию'`
5. Запушьте в ветку: `git push origin feature/новая-функция`
6. Создайте Pull Request

## Тестирование

Для локального тестирования используйте флаг `--dry-run`:
```bash
python main.py --dry-run
```

Это выполнит все операции, кроме загрузки в GitHub.

## Требования

- Python 3.8+
- Зависимости из `requirements.txt`

## Архитектурные принципы

- Модульность: каждый компонент выполняет одну задачу
- Тестируемость: функции должны быть легко тестируемыми
- Производительность: параллельные операции, эффективные алгоритмы
- Обработка ошибок: устойчивость к сбоям внешних сервисов